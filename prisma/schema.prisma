datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum EventType {
  mens
  womens
  mixed
}

enum DivisionFormat {
  singles
  doubles
}

enum RegistrationStatus {
  confirmed
}

enum PaymentStatus {
  unpaid
}

model Tournament {
  id                   String         @id @default(cuid())
  name                 String
  slug                 String         @unique
  startDate            DateTime       @map("start_date")
  endDate              DateTime       @map("end_date")
  location             String         @default("Tres Palapas Baja Pickleball Resort, Los Barriles, Mexico")
  descriptionShort     String         @map("description_short")
  registrationDeadline DateTime       @map("registration_deadline")
  createdAt            DateTime       @default(now()) @map("created_at")
  updatedAt            DateTime       @updatedAt @map("updated_at")
  divisions            Division[]
  registrations        Registration[]

  @@map("tournaments")
}

model Division {
  id           String         @id @default(cuid())
  tournamentId String         @map("tournament_id")
  name         String
  eventType    EventType      @map("event_type")
  format       DivisionFormat
  skillLevel   String         @map("skill_level")
  price        Decimal        @db.Decimal(10, 2)
  capacity     Int
  isOpen       Boolean        @default(true) @map("is_open")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  tournament   Tournament     @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  registrations Registration[]
  teams        Team[]

  @@map("divisions")
}

model Registration {
  id            String             @id @default(cuid())
  tournamentId  String             @map("tournament_id")
  divisionId    String             @map("division_id")
  playerId      String?            @unique @map("player_id")
  teamId        String?            @unique @map("team_id")
  status        RegistrationStatus @default(confirmed)
  paymentStatus PaymentStatus      @default(unpaid) @map("payment_status")
  notes         String?
  createdAt     DateTime           @default(now()) @map("created_at")
  tournament    Tournament         @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  division      Division           @relation(fields: [divisionId], references: [id], onDelete: Cascade)
  player        Player?            @relation("SinglesPlayer", fields: [playerId], references: [id], onDelete: SetNull)
  team          Team?

  @@index([divisionId])
  @@index([tournamentId])
  @@map("registrations")
}

model Team {
  id             String       @id @default(cuid())
  divisionId     String       @map("division_id")
  registrationId String       @unique @map("registration_id")
  teamName       String?      @map("team_name")
  player1Id      String       @map("player1_id")
  player2Id      String       @map("player2_id")
  createdAt      DateTime     @default(now()) @map("created_at")
  division       Division     @relation(fields: [divisionId], references: [id], onDelete: Cascade)
  registration   Registration @relation(fields: [registrationId], references: [id], onDelete: Cascade)
  player1        Player       @relation("TeamPlayer1", fields: [player1Id], references: [id], onDelete: Cascade)
  player2        Player       @relation("TeamPlayer2", fields: [player2Id], references: [id], onDelete: Cascade)

  @@map("teams")
}

model Player {
  id              String         @id @default(cuid())
  name            String
  email           String
  phone           String?
  skillLevel      String         @map("skill_level")
  createdAt       DateTime       @default(now()) @map("created_at")
  singleRegistration Registration? @relation("SinglesPlayer")
  teamsAsPlayer1  Team[]         @relation("TeamPlayer1")
  teamsAsPlayer2  Team[]         @relation("TeamPlayer2")

  @@index([email])
  @@map("players")
}
